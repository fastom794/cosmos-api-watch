<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cosmos API Watch</title>
    <link rel="stylesheet" href="/static/style.css?v=2">
</head>
<body>
<h1>Cosmos API Watch</h1>

<section class="api-help">
    <h2>API overview</h2>
    <ul>
	<li><code>GET /health</code> — service health check.</li>
	<li><code>GET /api/projects</code> — list of projects (slug, name).</li>
	<li><code>GET /api/projects/{project_slug}/networks</code> — networks of a project (network_type, chain_id).</li>
	<li><code>GET /api/projects/{project_slug}/{network_type}/endpoints?only_enabled=true</code> — endpoints for a project's mainnet/testnet.</li>
	<li><code>GET /api/projects/{project_slug}/{network_type}/summary?max_delay=60</code> — summary for mainnet/testnet (height, delay, status).</li>

    </ul>
</section>

{# Unique values for filters #}
{% set ns = namespace(projects=[], network_types=[], chain_ids=[]) %}
{% for row in rows %}
    {% if row.project_slug not in ns.projects %}
        {% set _ = ns.projects.append(row.project_slug) %}
    {% endif %}
    {% if row.network_type not in ns.network_types %}
        {% set _ = ns.network_types.append(row.network_type) %}
    {% endif %}
    {% if row.chain_id not in ns.chain_ids %}
        {% set _ = ns.chain_ids.append(row.chain_id) %}
    {% endif %}
{% endfor %}

<div class="filters">
    <div class="filter">
        <label for="filter-project">Project</label>
        <select id="filter-project" onchange="filterTable()">
            <option value="">All</option>
            {% for value in ns.projects %}
                <option value="{{ value }}">{{ value }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter">
        <label for="filter-network-type">Network type</label>
        <select id="filter-network-type" onchange="filterTable()">
            <option value="">All</option>
            {% for value in ns.network_types %}
                <option value="{{ value }}">{{ value }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter">
        <label for="filter-chain-id">Chain ID</label>
        <select id="filter-chain-id" onchange="filterTable()">
            <option value="">All</option>
            {% for value in ns.chain_ids %}
                <option value="{{ value }}">{{ value }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter">
        <label for="filter-type">Endpoint type</label>
        <select id="filter-type" onchange="filterTable()">
            <option value="">All</option>
            <option value="rpc">rpc</option>
            <option value="api">api</option>
        </select>
    </div>

    <div class="filter">
        <label for="filter-enabled">Enabled</label>
        <select id="filter-enabled" onchange="filterTable()">
            <option value="">All</option>
            <option value="yes" selected>yes</option>
            <option value="no">no</option>
        </select>
    </div>

    <div class="filter">
        <label for="filter-status">Status</label>
        <select id="filter-status" onchange="filterTable()">
            <option value="">All</option>
            <option value="up">up</option>
            <option value="down">down</option>
            <option value="unknown">unknown</option>
        </select>
    </div>
</div>

<table>
    <thead>
    <tr>
        <th>Project</th>
        <th>Network type</th>
        <th>Chain ID</th>

        <th>Endpoint type</th>
        <th>Endpoint name (Provider)</th>
        <th>URL</th>
        <th>Enabled</th>

        <th>Status</th>
        <th>Block height</th>
        <th>Block delay</th>
        <th>Last check</th>
        <th>HTTP / Error</th>
    </tr>
    </thead>
    <tbody>
    {% for row in rows %}
        {% set status_str = (
            'up' if row.is_available is true else
            'down' if row.is_available is false else
            'unknown'
        ) %}
        {% set delay_ms = row.block_delay_ms %}
        {% set delay_is_bad = delay_ms is not none and delay_ms > 60000 %}

        <tr
            data-project="{{ row.project_slug }}"
            data-network-type="{{ row.network_type }}"
            data-chain-id="{{ row.chain_id }}"
            data-endpoint-type="{{ row.endpoint_type }}"
            data-enabled="{{ 'yes' if row.enabled else 'no' }}"
            data-status="{{ status_str }}"
        >
            <td>{{ row.project_slug }}</td>
            <td>{{ row.network_type }}</td>
            <td>{{ row.chain_id }}</td>

            <td>{{ row.endpoint_type }}</td>
            <td>
		{% if row.endpoint_name %}
                    <a href="https://{{ row.endpoint_name }}/" target="_blank">{{ row.endpoint_name }}</a>
                {% endif %}
	    </td>
            <td>
                {% if row.url %}
                    <a href="{{ row.url }}" target="_blank">{{ row.url }}</a>
                {% endif %}
            </td>
            <td>{{ "yes" if row.enabled else "no" }}</td>

            <td>
                {% if status_str == 'up' %}
                    <span class="status status-up">up</span>
                {% elif status_str == 'down' %}
                    <span class="status status-down">down</span>
                {% else %}
                    <span class="status status-unknown">?</span>
                {% endif %}
            </td>

            <td>{{ row.block_height or "" }}</td>

            <td class="{% if delay_is_bad %}delay-bad{% endif %}">
                {{ row.block_delay_human }}
            </td>

            <td class="last-check"
                data-last-checked="{{ row.last_checked_iso }}">
            </td>

            <td>
                {% if row.error_message %}
                    {{ row.error_message }}
                {% elif row.status_code %}
                    HTTP {{ row.status_code }}
                {% else %}
                    ""
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
<script src="/static/table.js?v=2"></script>

<footer class="footer">
    <div class="footer-content">
        <span>Cosmos API Watch</span>
        <a href="https://github.com/fastom794/cosmos-api-watch" target="_blank">
            <svg class="gh-icon" viewBox="0 0 16 16" width="18" height="18" aria-hidden="true">
                <path fill="currentColor"
                      d="M8 0C3.58 0 0 3.58 0 8c0 3.54 
                      2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 
                      0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94
                      -.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52
                      -.01-.53.63-.01 1.08.58 1.23.82.72 1.21 
                      1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2
                      -3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2
                      -.36-1.02.08-2.12 0 0 .67-.21 2.2.82A7.68 
                      7.68 0 0 1 8 3.89c.68.003 1.37.092 2.01.27 
                      1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 
                      2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 
                      3.75-3.65 3.95.29.25.54.73.54 1.48 
                      0 1.07-.01 1.93-.01 2.19 0 .21.15.46.55.38A8.013 
                      8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
            GitHub
        </a>
    </div>
</footer>

</body>
</html>

